# ImageBox

ImageBox 是一个将文字转换为自定义图片的工具

## 功能特点

- 支持自定义背景图片、字体、文字颜色、阴影等多种样式；
- 支持快捷键一键生成并发送图片；
- 支持系统托盘图标，方便后台运行和管理；
- 跨平台支持，适用于 Windows、macOS 和 Linux。

## 安装方法

1. 下载适用于操作系统的可执行文件，推荐放于独立目录内(注: 如果提供了压缩包，请解压后检查是否包含所有必要文件)；
2. 下载对应的资源文件包，解压后将 `data` 文件夹放置于可执行文件同级目录下(data文件夹内应包含 `data.json` 及其他资源文件)；
3. 运行可执行文件，程序会在系统托盘中显示图标，右键图标可打开控制菜单。

## 使用说明

### 配置文件

配置文件位于 `config.yaml`，在程序首次运行时会自动生成，用户可以根据需要进行修改，具体配置项说明如下(不含快捷键部分)：

- `current_character`: 当前使用的角色 ID；
- `auto_paste`: 是否启用自动粘贴功能，默认值为 `true`；
- `auto_send`: 是否启用自动发送功能，默认值为 `false`；
- `intercept_enter`: 是否拦截 Enter 键，默认值为 `false`；
- `enable_whitelist`: 是否启用白名单功能，默认值为 `true`；
- `whitelist`: 白名单列表，包含允许触发快捷键的应用程序名称；
- `max_image_size`: 生成图片的最大预估大小（采用 PNG 压缩预估，不保证一定小于此数值），单位为 KB，设置为 `0` 时不进行压缩，默认值为 `256`。

配置文件支持自动热重载。

### 快捷键

快捷键均可在配置文件中进行修改，具体配置项说明如下：

- `toggle_hotkey`: 切换拦截 Enter 键功能的快捷键，默认值为 `Ctrl + Shift + T`，启用 Enter 键拦截功能后强制进行自动粘贴与发送。
- `generate_hotkey`: 生成图片快捷键，默认值为 `Ctrl + E`，用于选中全部文字并生成图片，根据 `auto_paste` 和 `auto_send` 配置决定是否自动粘贴与发送。

### 资源配置

资源配置文件位于 `data/data.json`，用户可以根据需要添加或修改角色配置，具体配置项说明如下：

- `characters`: 角色列表对象，键为角色 ID，值为包含以下属性的对象：
  - `name`: 角色名称（不可在模板中指定）；
  - `backgrounds`: 背景图片文件路径列表，可使用 glob 模式匹配多个文件，路径相对于 `data/backgrounds` 目录；
  - `font`: 字体文件路径，路径相对于 `data/fonts` 目录；
  - `primary_color`: 角色主题颜色，详细说明参考下文；
  - `objects`: 放置物件列表，详细说明参考下文；
  - `textarea`: 文字区域配置，详细说明参考下文。
- `templates`: 角色模板对象，在其中指定的值会作为所有角色的默认值。

资源配置文件中所有颜色均支持以下格式：

- `[R, G, B]`：RGB 数值数组，取值范围为 `0-255`；
- `[R, G, B, A]`：RGBA 数值数组，取值范围为 `0-255`；
- `primary`：使用角色的主题颜色；
- `white`：白色，等同于 `[255, 255, 255]`；

在使用未知颜色字符串时会默认使用黑色，角色默认主题颜色为黑色。

放置物件包含图片、文字两种，通过 `type` 属性区分：

- 图片物件：
  - `type`: `"image"`；
  - `position`: 位置坐标，格式为 `[x, y]`；
  - `path`: 图片文件路径列表，解析方式同背景文件，路径相对于 `data/images` 目录，可使用 `%c` 表示当前角色 ID；
- 文字物件：
  - `type`: `"text"`；
  - `position`: 位置坐标，格式为 `[x, y]`；
  - `text`: 文字内容；
  - `font_color`: 文字颜色；
  - `font_size`: 文字大小；

放置物件会按照在列表中出现的顺序依次绘制，`template` 中的配置会在各角色配置前绘制。

文字区域用于显示输入的文字，包含以下属性：

- `position`: 位置坐标，格式为 `[x, y]`；
- `size`: 区域大小，格式为 `[width, height]`；
- `font_color`: 文字颜色；
- `highlight`: (可选项)高亮颜色，用于强调“【】”或“[]”内的文字，缺省时不启用高亮；
- `max_font_size`: 最大字体大小；
- `shadow_offset`: (可选项)阴影偏移量，格式为 `[x_offset, y_offset]`，默认值为 `[0, 0]`；
- `line_spacing`: (可选项)行间距，默认值为 `0`；
- `align`: (可选项)水平对齐方式，可选值为 `"left"`、`"center"`、`"right"`，默认值为 `"left"`；
- `valign`: (可选项)垂直对齐方式，可选值为 `"top"`、`"middle"`、`"bottom"`，默认值为 `"top"`。

## TODO

- [ ] 热重载资源配置
- [ ] 表情绘制支持

## 许可证

本项目采用 MPL-2.0 许可证，详见 LICENSE 文件。

## 致谢

本项目参考了 [ManosabaTextBox](https://github.com/oplivilqo/manosaba_text_box) 的处理流程，由 Rust 重写而来，特此感谢。
